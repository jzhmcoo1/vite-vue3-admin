var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,n=(a,t,r)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,d=(e,a)=>{for(var t in a||(a={}))l.call(a,t)&&n(e,t,a[t]);if(r)for(var t of r(a))o.call(a,t)&&n(e,t,a[t]);return e},s=(e,r)=>a(e,t(r));import{b as i,e as c,f as p,a as u,h as m,i as f}from"./index.b991ccdb.js";import{g as b}from"./index.fc9a4914.js";import{D as h}from"./dynamic-table.5f6c942d.js";import{u as y}from"./useFormModal.9143189f.js";import{b as v,a as I}from"./utils.1ab06744.js";import{d as x,r as g,x as w,b as P,c as k,y as j,z as O,P as K,h as S}from"./vendor.02104a40.js";import"./index.3831b623.js";const T=[{title:"#",dataIndex:"id",width:55,align:"center",hideInSearch:!0},{title:"名称",width:200,align:"center",dataIndex:"name"},{title:"标识",width:80,align:"center",dataIndex:"label"},{title:"备注",dataIndex:"remark",align:"center"},{title:"创建时间",dataIndex:"createdAt",align:"center",hideInSearch:!0},{title:"更新时间",align:"center",dataIndex:"updatedAt",hideInSearch:!0}],C=[{field:"name",component:"Input",label:"名称",rules:[{required:!0,type:"string"}],colProps:{span:12}},{field:"label",component:"Input",label:"标识",rules:[{required:!0,type:"string"}],colProps:{span:12}},{field:"remark",component:"InputTextArea",label:"备注"},{field:"menus",component:"Tree",label:"菜单权限",colProps:{span:12},componentProps:{checkable:!0,vModelKey:"checkedKeys",style:{height:"300px",paddingTop:"5px",overflow:"auto",borderRadius:"6px",border:"1px solid #dcdfe6"}}},{field:"depts",component:"Tree",label:"部门权限",colProps:{span:12},componentProps:{checkable:!0,vModelKey:"checkedKeys",style:{height:"300px",paddingTop:"5px",overflow:"auto",borderRadius:"6px",border:"1px solid #dcdfe6"}}}],R=S(" 新增 "),q=x(s(d({},{name:"SystemPermissionRole"}),{setup(e){const a=g(),[t]=y(),r=(e,a,t=[])=>a.reduce(((a,l)=>{var o;return(null==(o=l.children)?void 0:o.length)?r(e,l.children,t):e.includes(l.value)&&a.push(l.value),a}),t),l=async e=>{var l,o;const[n]=await t({modalProps:{title:(e.id?"编辑":"新增")+"角色",width:"50%",onFinish:async t=>{var r,l,o,i,u;e.id&&(t.roleId=e.id);const m=null==(l=null==(r=n.value)?void 0:r.compRefs)?void 0:l.menus,f=null==(i=null==(o=n.value)?void 0:o.compRefs)?void 0:i.depts,b=s(d({},t),{menus:[...m.halfCheckedKeys,...m.checkedKeys],depts:[...f.halfCheckedKeys,...f.checkedKeys]});await(e.id?c:p)(b),null==(u=a.value)||u.refreshTable()}},formSchema:{labelWidth:100,layout:"vertical",schemas:C}}),[i,f]=await Promise.all([u(),b()]),h=v(f),y=I(i);if(null==(l=n.value)||l.updateSchema([{field:"menus",componentProps:{treeData:h}},{field:"depts",componentProps:{treeData:y}}]),e.id){const a=await m({roleId:e.id}),t=a.menus.map((e=>e.menuId)),l=a.depts.map((e=>e.departmentId));null==(o=n.value)||o.setFieldsValue(s(d({},e),{name:a.roleInfo.name,label:a.roleInfo.label,remark:a.roleInfo.remark,menus:r(t,h),depts:r(l,y)}))}},o=[...T,{title:"操作",width:160,dataIndex:"$action",hideInSearch:!0,align:"center",fixed:"right",actions:({record:e})=>[{label:"编辑",auth:{perm:"sys.role.update",effect:"disable"},onClick:()=>l(e)},{label:"删除",auth:"sys.role.delete",popConfirm:{title:"你确定要删除吗？",onConfirm:()=>(async e=>{var t;await f({roleIds:[e.id]}),null==(t=a.value)||t.refreshTable()})(e)}}]}];return(e,t)=>{const r=w("a-button");return P(),k("div",null,[j(K(h),{ref_key:"dynamicTableRef",ref:a,"row-key":"id","header-title":"角色管理","data-request":K(i),columns:o,bordered:"",size:"small"},{toolbar:O((()=>[j(r,{type:"primary",disabled:!e.$auth("sys.role.add"),onClick:t[0]||(t[0]=e=>l({}))},{default:O((()=>[R])),_:1},8,["disabled"])])),_:1},8,["data-request"])])}}}));export{q as default};
