!function(){var e=document.createElement("style");e.innerHTML=".split-wrapper{display:flex;width:100%;height:100%;background-color:#fff}.split-wrapper .scalable{position:relative;width:240px;max-width:50vw;min-width:100px;overflow:auto}.split-wrapper .scalable .left-content{height:100%;padding:12px 20px 12px 12px}.split-wrapper .scalable .separator{position:absolute;top:0;right:0;display:flex;width:14px;height:100%;cursor:col-resize;background-color:#fff;box-shadow:-4px -2px 4px -5px rgba(0,0,0,.35),4px 3px 4px -5px rgba(0,0,0,.35);align-items:center;justify-content:center}.split-wrapper .scalable .separator i{width:1px;height:14px;margin:0 1px;background-color:#e9e9e9}.split-wrapper .right-content{flex:1}.split-wrapper .left-content,.split-wrapper .right-content{overflow:auto}\n",document.head.appendChild(e),System.register(["./vendor-legacy.89403358.js","./dynamic-table-legacy.1d55156b.js","./index-legacy.f7bd82b9.js","./index-legacy.357eef54.js","./useFormModal-legacy.e556ff3e.js","./utils-legacy.76523550.js"],(function(e){"use strict";var t,a,l,n,d,o,r,s,i,c,u,p,m,f,y,h,v,b,w,g,x,I,k,P,C,S,K,T,_,E,j,q,$,F,R,N,D,M,A,L,V,W,O,z,G,H;return{setters:[function(e){t=e.d,a=e.r,l=e.av,n=e.b,d=e.c,o=e.e,r=e.a8,s=e.h,i=e.y,c=e.W,u=e.bz,p=e.cy,m=e.aq,f=e.k,y=e.l,h=e.x,v=e.A,b=e.z,w=e.P,g=e.aI,x=e.cF,I=e.C,k=e.cG,P=e.aZ,C=e.ac,S=e.cH,K=e.cI,T=e.t,_=e.aA,E=e.a5,j=e.by,q=e.cJ,$=e.M,F=e.cK},function(e){R=e.D},function(e){N=e.y,D=e.B},function(e){M=e.g,A=e.u,L=e.c,V=e.t,W=e.d,O=e.a},function(e){z=e.u},function(e){G=e.f,H=e.a}],execute:function(){const U={class:"split-wrapper"},X={class:"left-content"},B=s(" 右边内容区 "),J=[o("i",null,null,-1),o("i",null,null,-1)],Z={class:"right-content"},Q=s(" 右边内容区 ");var Y=t({setup(e){const t=a();let s,i;const c=l((function(e){t.value&&(t.value.style.width=i+e.clientX-s+"px")}),20),u=()=>{document.documentElement.style.userSelect="unset",document.documentElement.removeEventListener("mousemove",c),document.documentElement.removeEventListener("mouseup",u)},p=e=>{s=e.clientX,t.value&&(i=parseInt(window.getComputedStyle(t.value).width,10)),document.documentElement.style.userSelect="none",document.documentElement.addEventListener("mousemove",c),document.documentElement.addEventListener("mouseup",u)};return(e,a)=>(n(),d("div",U,[o("div",{ref_key:"scalable",ref:t,class:"scalable"},[o("div",X,[r(e.$slots,"left-content",{},(()=>[B]))]),o("div",{ref:"separator",class:"separator",onMousedown:p},J,544)],512),o("div",Z,[r(e.$slots,"right-content",{},(()=>[Q]))])]))}});function ee(e){return N({url:D.add,method:"post",data:e},{successMsg:"创建用户成功"})}function te(e){return N({url:D.update,method:"post",data:e},{successMsg:"修改用户成功"})}function ae(e){return N({url:D.delete,method:"post",data:e})}const le=[{field:"name",component:"Input",label:"部门名称",rules:[{required:!0,type:"string"}]},{field:"parentId",component:"TreeSelect",label:"上级部门",componentProps:{getPopupContainer:()=>document.body},rules:[{required:!0,type:"number"}]},{field:"orderNum",component:"InputNumber",label:"排序号",defaultValue:255,componentProps:{style:{width:"100%"}}}],ne=[{field:"departmentId",component:"TreeSelect",label:"所属部门",componentProps:{getPopupContainer:()=>document.body},rules:[{required:!0,type:"number"}]},{field:"roles",component:"Select",label:"所属角色",rules:[{required:!0,type:"array"}],componentProps:{mode:"multiple",request:async()=>(await M()).map((e=>({label:e.name,value:e.id})))}},{field:"username",component:"Input",label:"用户名",rules:[{required:!0}]},{field:"name",component:"Input",label:"姓名",colProps:{span:12},rules:[{required:!0}]},{field:"nickName",component:"Input",label:"呢称",colProps:{span:12}},{field:"email",component:"Input",label:"邮箱",colProps:{span:12}},{field:"phone",component:"Input",label:"手机",colProps:{span:12}},{field:"remark",component:"InputTextArea",label:"备注"},{field:"status",component:"RadioGroup",label:"状态",defaultValue:1,componentProps:{options:[{label:"启用",value:1},{label:"禁用",value:0}]}}],de=[{field:"password",component:"Input",label:"新密码",rules:[{required:!0,type:"string"}]}],oe=[{field:"departmentId",component:"TreeSelect",label:"转移至",rules:[{required:!0,type:"number"}]}];function re(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!p(e)}const se=[{title:"头像",width:80,dataIndex:"headImg",hideInSearch:!0,bodyCell:({record:e})=>i(c,{src:e.headImg},null)},{title:"姓名",width:120,dataIndex:"name",align:"center"},{title:"用户名",width:120,align:"center",dataIndex:"username"},{title:"所在部门",dataIndex:"departmentName",hideInSearch:!0,align:"center",width:180},{title:"所属角色",dataIndex:"roleNames",align:"center",hideInSearch:!0,width:220,bodyCell:({record:e})=>{let t;return i(m,null,re(t=e.roleNames.map((e=>i(u,{color:"success",key:e},re(e)?e:{default:()=>[e]}))))?t:{default:()=>[t]})}},{title:"呢称",width:120,align:"center",dataIndex:"nickName"},{title:"邮箱",width:120,align:"center",dataIndex:"email"},{title:"手机",width:120,align:"center",dataIndex:"phone"},{title:"备注",width:120,align:"center",dataIndex:"remark"},{title:"状态",dataIndex:"status",width:100,formItemProps:{component:"Select",componentProps:{options:[{label:"启用",value:1},{label:"禁用",value:0}]}},bodyCell:({record:e})=>{const t=1===e.status;return i(u,{color:t?"success":"red"},{default:()=>[t?"启用":"禁用"]})}}],ie={class:"flex justify-between"},ce=o("div",null,"组织架构",-1),ue=s("新增部门 "),pe=s("刷新 "),me=s(" 编辑 "),fe=s(" 删除 "),ye=s("取消选择"),he=s(" 新增 "),ve=s(" 转移 "),be=s(" 删除 ");e("default",t({name:"SystemUser",setup(e){const[t]=z(),l=a(!1),d=a(),r=f({expandedKeys:[],departmentIds:[],deptTree:[]}),c=a({selectedRowKeys:[],onChange:(e,t)=>{c.value.selectedRowKeys=e}}),u=y((()=>c.value.selectedRowKeys.length)),p=async(e={})=>{var a,l,n;const[d]=await t({modalProps:{title:(e.id?"编辑":"新增")+"部门",width:700,onFinish:async t=>{t.id=e.id,await(e.id?A:L)(t),B()}},formSchema:{labelWidth:100,layout:"vertical",schemas:le}});null===(a=d.value)||void 0===a||a.updateSchema([{field:"parentId",componentProps:{treeDefaultExpandedKeys:[-1].concat((null==e?void 0:e.keyPath)||[]),treeData:[{key:-1,title:"#",children:r.deptTree}]}}]),null===(l=d.value)||void 0===l||l.setFieldsValue({...e,parentId:null!==(n=e.parentId)&&void 0!==n?n:-1})},M=async()=>{var e;const[a]=await t({modalProps:{title:"转移部门",width:700,onFinish:async e=>{await V({departmentId:e.departmentId,userIds:c.value.selectedRowKeys.map((e=>e))})}},formSchema:{labelWidth:100,layout:"vertical",schemas:oe}});null===(e=a.value)||void 0===e||e.updateSchema([{field:"departmentId",componentProps:{treeData:r.deptTree}}])},U=async(e={})=>{var a,l,n;const[o]=await t({modalProps:{title:(e.id?"编辑":"新增")+"用户",width:700,onFinish:async t=>{var a;t.id=e.id,await(e.id?te:ee)(t),null===(a=d.value)||void 0===a||a.refreshTable()}},formSchema:{labelWidth:100,layout:"vertical",schemas:ne}});if(null===(a=o.value)||void 0===a||a.updateSchema([{field:"departmentId",componentProps:{treeDefaultExpandedKeys:(null===(l=G(null==e?void 0:e.departmentId,r.deptTree))||void 0===l?void 0:l.keyPath)||[],treeData:r.deptTree}}]),null===(n=o.value)||void 0===n||n.setFieldsValue(e),null!=e&&e.id){var s;const{roles:t}=await(i={userId:e.id},N({url:D.info,method:"get",params:i}));null===(s=o.value)||void 0===s||s.setFieldsValue({roles:t})}var i},X=async e=>{await t({modalProps:{title:`修改密码(${e.username})`,width:700,onFinish:async t=>{var a;await(a={userId:e.id,password:t.password},N({url:D.password,method:"post",data:a},{successMsg:"操作成功"}))}},formSchema:{labelWidth:100,layout:"vertical",schemas:de}})},B=async()=>{l.value=!0;const e=await O().finally((()=>l.value=!1));r.deptTree=H(e),r.expandedKeys=[...r.expandedKeys,...r.deptTree.map((e=>Number(e.key)))]};B();const J=async e=>{var t;Array.isArray(e)?$.confirm({title:"确定要删除所选的用户吗?",icon:i(F,null,null),centered:!0,onOk:async()=>{await ae({userIds:e}),B()}}):await ae({userIds:[e]}).finally(null===(t=d.value)||void 0===t?void 0:t.refreshTable)},Z=e=>{var t,a;r.departmentIds=e,null==d||null===(t=d.value)||void 0===t||null===(a=t.refreshTable)||void 0===a||a.call(t)},Q=async({page:e,limit:t})=>{const a=await function(e){return N({url:D.page,method:"post",data:e})}({page:e,limit:t,departmentIds:r.departmentIds.length?r.departmentIds:void 0});return c.value.selectedRowKeys=[],a},re=[...se,{title:"操作",width:220,dataIndex:"$action",align:"center",fixed:"right",actions:({record:e})=>[{label:"编辑",auth:{perm:"sys.user.update",effect:"disable"},onClick:()=>U(e)},{label:"改密",auth:"sys.user.password",onClick:()=>X(e)},{label:"删除",auth:"sys.user.delete",popConfirm:{title:"你确定要删除吗？",onConfirm:()=>J(e.id)}}]}];return(e,t)=>{const a=h("a-button");return n(),v(w(Y),null,{"left-content":b((()=>[o("div",ie,[ce,i(w(m),null,{default:b((()=>[e.$auth("sys.dept.add")?(n(),v(w(g),{key:0,placement:"top"},{title:b((()=>[ue])),default:b((()=>[i(w(x),{onClick:t[0]||(t[0]=e=>p({}))})])),_:1})):I("",!0),i(w(g),{placement:"top"},{title:b((()=>[pe])),default:b((()=>[i(w(k),{spin:l.value,onClick:B},null,8,["spin"])])),_:1})])),_:1})]),i(w(_),{expandedKeys:w(r).expandedKeys,"onUpdate:expandedKeys":t[1]||(t[1]=e=>w(r).expandedKeys=e),autoExpandParent:"","tree-data":w(r).deptTree,onSelect:Z},{title:b((({key:t,title:a,formData:l})=>[i(w(P),{trigger:["contextmenu"]},{overlay:b((()=>[i(w(C),null,{default:b((()=>[i(w(C).Item,{key:"1",disabled:!e.$auth("sys.dept.update"),onClick:e=>p(l)},{default:b((()=>[me,i(w(S))])),_:2},1032,["disabled","onClick"]),i(w(C).Item,{key:"2",disabled:!e.$auth("sys.dept.delete"),onClick:e=>{return a=t,void $.confirm({title:"确定要删除该部门吗?",icon:i(F,null,null),centered:!0,onOk:async()=>{await W({departmentId:a}),B()}});var a}},{default:b((()=>[fe,i(w(K))])),_:2},1032,["disabled","onClick"])])),_:2},1024)])),default:b((()=>[o("span",null,T(a),1)])),_:2},1024)])),_:1},8,["expandedKeys","tree-data"])])),"right-content":b((()=>[i(w(R),{ref_key:"dynamicTableRef",ref:d,"header-title":"用户管理","show-index":"",titleTooltip:"请不要随意删除用户，避免到影响其他用户的使用。","data-request":Q,columns:re,scroll:{x:2e3},"row-selection":c.value},E({toolbar:b((()=>[i(a,{type:"primary",disabled:!e.$auth("sys.user.add"),onClick:t[3]||(t[3]=e=>U({}))},{default:b((()=>[i(w(x)),he])),_:1},8,["disabled"]),i(a,{type:"success",disabled:!w(u)||!e.$auth("sys.dept.transfer"),onClick:M},{default:b((()=>[i(w(q)),ve])),_:1},8,["disabled"]),i(a,{type:"danger",disabled:!w(u)||!e.$auth("sys.user.delete"),onClick:t[4]||(t[4]=e=>J(c.value.selectedRowKeys))},{default:b((()=>[i(w(K)),be])),_:1},8,["disabled"])])),_:2},[w(u)?{name:"title",fn:b((()=>[i(w(j),{class:"w-full",type:"info","show-icon":""},{message:b((()=>[s(" 已选 "+T(w(u))+" 项 ",1),i(a,{type:"link",onClick:t[2]||(t[2]=e=>c.value.selectedRowKeys=[])},{default:b((()=>[ye])),_:1})])),_:1})]))}:void 0]),1032,["row-selection"])])),_:1})}}}))}}}))}();
